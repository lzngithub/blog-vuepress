---
title: Linux部署前端项目
date: 2022-01-10 11:43:48
permalink: /pages/5f5b7d/
categories:
    - 后端
    - linux
tags:
    -
---

# linux 部署前端项目

部署项目可以用 nginx 也可以用 node，因为我是前端的，先学习用 node 进行前端项目的部署

## linux 安装 nodejs

通过 nodejs 官网获取下载连接地址

![获取连接地址](/page/linux-node.png)

进入 home 文件目录

```shell
cd ~
```

通过 wget 安装

```shell
wget https://nodejs.org/dist/v16.13.1/node-v16.13.1-linux-x64.tar.xz
```

解压

```shell
tar -xvf node-v16.13.1-linux-x64.tar.xz
```

进入 bin 文件夹

```shell
cd node-v16.13.1-linux-x64/bin
```

查看 node 版本，确认安装成功

```shell
./node -v
```

修改 node 文件安装路径，方便自己管理，进入/usr/local/node/路径

```shell
mkdir node_global
mkdir node_cache
npm config set prefix "node_global"
npm config set cache "node_cache"
```

配置环境变量

打开配置文件

```shell
vim /etc/profile
```

在文件后面加入下面内容

```shell
#往 .bash_profile 新增环境变量
export NODE_HOME=/root/node-v16.13.1-linux-x64
export PATH=$PATH:$NODE_HOME/bin
export PATH=$PATH:/usr/local/node/node_global/bin
export NODE_PATH=/usr/local/node/node_global/lib/node_modules
```

使添加的 PATH 立即生效，不然需要重新登录才能生效

```shell
source /etc/profile
```

验证，全局任何一个地方产看 node 和 npm 版本号能成功显示则为成功

```shell
node -v
npm -v
```

## 安装git

安装git主要为了拉代码

## 编写接口接收 webhook 的反馈

新建backend.js文件

```js
var http = require('http')
var createHandler = require('github-webhook-handler')
var spawn = require('child_process').spawn
var handler = createHandler({ path: '/pushCode', secret: 'liangzn' })

http.createServer(function (req, res) {
	handler(req, res, function (err) {
		res.statusCode = 404
		res.end('no such location')
	})
}).listen(3000, () => {
	console.log('服务已启动，3000端口')
})

handler.on('error', function (err) {
	console.error('Error:', err)
})

handler.on('push', function (event) {
	console.log('Received a push')
	const rumCommand = (cmd, args, callback) => {
		const child = spawn(cmd, args)
		let response = ''
		child.stdout.on('data', (buffer) => (response += buffer.toString()))
		child.stdout.on('end', () => callback(response))
	}
	// 执行自动部署脚本
	rumCommand('sh', ['./auto_build.sh'], (txt) => {
		console.log('部署成功')
		console.log(txt)
	})
})
```

## 遇到坑

### 做webhook的secret检验的时候，用了github-webhook-handler这个插件，但这个插件跟express是不兼容的，后面用了原生的方法取写接口